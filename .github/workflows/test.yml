name: Canchu

on: 
 push:
   branches:
     - master
 workflow_dispatch:

permissions:
  contents: write

jobs:    
  test:
    runs-on: ubuntu-latest
    steps:
     - name: Checkout code
       uses: actions/checkout@v3
     - name: Build docker compose for test
       run: |
         cd api/1.0
         echo "${{ secrets.ENV_FILE  }}" > .env
         mkdir private
         echo "${{ secrets.PRIVATE_KEY }}" > private/private.key
         echo "${{ secrets.COMBINED_CRT }}" > private/combined.crt
         docker-compose up --build -d
         docker logs canchu
         docker logs canchu_mysql
         docker logs canchu_redis
         docker logs nginx
     # - name: Wait for containers to start
     #   run: sleep 30
     # - name: Run test file
     #   run: |
     #     cd api/1.0
     #     docker logs canchu
     #     docker exec canchu npm test -- --watch=false --forceExit
         
